stages:
#    - clone
    - test
    - cleanup
    - build
    - deploy

#clone:
#    stage: clone
#    tags:
#        - social
#    script:
#        - git clone git@gitlab.skillbox.ru:javapro_team27/javapro_teams27_backend.git

test:
    stage: test
    tags:
        - social
    script:
#        - cd /root/javapro_teams27_backend
        - mvn clean test
    allow_failure: true


cleanup:
    stage: cleanup
    tags:
        - social
    script:
        - docker stop javapro_teams27_backend
        - docker container prune
        - docker image rm javapro_teams27_backend
    allow_failure: true


build:
    stage: build
    tags:
        - social
    script:
#        - cd /root/javapro_teams27_backend
        - docker build -t javapro_teams27_backend:$CI_PIPELINE_ID .
    only:
        - aleksei

deploy:
    stage: deploy
    tags:
        - social
    script:
#        - cd /root/javapro_teams27_backend
        - docker run -d -p 8086:8086 --name javapro_teams27_backend:$CI_PIPELINE_ID
    only:
        - aleksei